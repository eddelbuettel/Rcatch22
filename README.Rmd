---
output: rmarkdown::github_document
---

# Rcatch22 <img src="man/figures/logo.png" align="right" width="120" />

[![CRAN version](http://www.r-pkg.org/badges/version/Rcatch22)](http://www.r-pkg.org/pkg/Rcatch22)
[![CRAN RStudio mirror downloads](http://cranlogs.r-pkg.org/badges/Rcatch22)](http://www.r-pkg.org/pkg/Rcatch22)
[![DOI](https://zenodo.org/badge/353530083.svg)](https://zenodo.org/badge/latestdoi/353530083)

R package for the calculation of [22 CAnonical Time-series CHaracteristics](https://github.com/chlubba/catch22). The package is an efficient implementation that calculates time-series features coded in C.

```{r, include = FALSE}
knitr::opts_chunk$set(
comment = NA, fig.width = 12, fig.height = 8, cache = FALSE)
```

## Installation

*Coming to CRAN soon... Stay posted!*

You can install the development version of `Rcatch22` from GitHub using the following:

```{r eval = FALSE}
devtools::install_github("hendersontrent/Rcatch22")
```

## Wiki

Please open the included vignette within an R environment or visit the detailed [`Rcatch22` Wiki](https://github.com/hendersontrent/Rcatch22/wiki) for information and tutorials.

## Computational performance

With features coded in C, `Rcatch22` is highly computationally efficient. Computation time in milliseconds for a range of time series is presented below.

```{r, message = FALSE, warning = FALSE, echo = FALSE}
library(dplyr)
library(ggplot2)
library(microbenchmark)
library(Rcatch22)

simulate_features <- function(method = c("Sinusoid", "WhiteNoise", "RandomWalk")){
  
  set.seed(123)
  storage <- list()
  baselengths <- c(100)
  otherlengths <- seq(from = 1000, to = 10000, by = 1000)
  lengths <- append(baselengths, otherlengths)
  
  for(i in lengths){
    
    if(method == "Sinusoid"){
      tmp <- sin(i)+rnorm(i, mean = 0, sd = 0.01)
    }
    
    if(method == "WhiteNoise"){
      tmp <- rnorm(i, mean = 0, sd = 1)
    }
    
    if(method == "RandomWalk"){
      tmp <- cumsum(rnorm(i, mean = 0, sd = 1))
    }
    
    m <- summary(microbenchmark(catch22_all(tmp), times = 50, unit = "ms"))
    
    m1 <- data.frame(m) %>%
      dplyr::select(c(mean, min, max)) %>%
      dplyr::mutate(sd = (max-min)/4) %>%
      dplyr::mutate(lower = mean+1.96*sd,
                    upper = mean-1.96*sd) %>%
      mutate(ts_length = i) %>%
      mutate(ts_type = method)
    
    storage[[i]] <- m1
  }
  
  outData <- data.table::rbindlist(storage, use.names = TRUE)
  return(outData)
}

# Run sims

sim_sin <- simulate_features(method = "Sinusoid")
sim_gauss <- simulate_features(method = "WhiteNoise")
sim_rw <- simulate_features(method = "RandomWalk")

# Pull into single dataframe

outs <- bind_rows(sim_sin, sim_gauss, sim_rw)
```

```{r, message = FALSE, warning = FALSE, echo = FALSE, fig.keep = TRUE}
# Draw graphic

outs %>%
  ggplot() +
  geom_errorbar(aes(x = ts_length, ymin = lower, ymax = upper, colour = ts_type)) +
  geom_line(aes(x = ts_length, y = mean, colour = ts_type)) +
  geom_point(aes(x = ts_length, y = mean, colour = ts_type)) +
  labs(title = "Computation time in milliseconds of Rcatch22 by type and length of time series",
       subtitle = "Bars indicate estimated 95% confidence interval over 50 simulations at each time point",
       x = "Time Series Length",
       y = "Computation Time (milliseconds)",
       colour = NULL) +
  theme_bw() +
  theme(panel.grid.minor = element_blank(),
        legend.position = "bottom")
```

## Citation

A DOI is provided at the top of this README. Alternatively, the package can be cited using the following:

```{r, echo = FALSE}
citation("Rcatch22")
```

Please also cite the original *catch22* paper by using:

* [Lubba et al. (2019). catch22: CAnonical Time-series CHaracteristics.](https://link.springer.com/article/10.1007/s10618-019-00647-x)
